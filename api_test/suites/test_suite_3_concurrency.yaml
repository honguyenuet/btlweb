---
# ============================================================================
# TEST SUITE 3: Concurrency Test (Multiple Parallel Requests)
# ============================================================================
# Chạy với concurrency:
#   pyresttest http://localhost:8000 api_test/test_suite_3_concurrency.yaml \
#     --max-concurrency 10
# ============================================================================

- config:
    testset: "Suite 3: Concurrency Test"
    timeout: 15

- test:
    name: "Login"
    url: http://localhost:8000/api/login
    method: POST
    headers:
      Content-Type: application/json
      Accept: application/json
    body: '{"email":"1@gmail.com","password":"Bao12345"}'
    expected_status: [200]
    extract_binds:
      - token: { jsonpath_mini: access_token }

# Nhiều requests giống nhau để test concurrent access
- test:
    name: "Concurrent Request 1"
    url: http://localhost:8000/api/getAllLikes
    method: GET
    headers: { template: { "Authorization": "Bearer $token" } }
    expected_status: [200]

- test:
    name: "Concurrent Request 2"
    url: http://localhost:8000/api/getAllLikes
    method: GET
    headers: { template: { "Authorization": "Bearer $token" } }
    expected_status: [200]

- test:
    name: "Concurrent Request 3"
    url: http://localhost:8000/api/getAllLikes
    method: GET
    headers: { template: { "Authorization": "Bearer $token" } }
    expected_status: [200]

- test:
    name: "Concurrent Request 4"
    url: http://localhost:8000/api/getAllLikes
    method: GET
    headers: { template: { "Authorization": "Bearer $token" } }
    expected_status: [200]

- test:
    name: "Concurrent Request 5"
    url: http://localhost:8000/api/getAllLikes
    method: GET
    headers: { template: { "Authorization": "Bearer $token" } }
    expected_status: [200]

- test:
    name: "Concurrent Request 6"
    url: http://localhost:8000/api/getPostById/1
    method: GET
    headers: { template: { "Authorization": "Bearer $token" } }
    expected_status: [200, 404]

- test:
    name: "Concurrent Request 7"
    url: http://localhost:8000/api/getPostById/2
    method: GET
    headers: { template: { "Authorization": "Bearer $token" } }
    expected_status: [200, 404]

- test:
    name: "Concurrent Request 8"
    url: http://localhost:8000/api/getPostById/3
    method: GET
    headers: { template: { "Authorization": "Bearer $token" } }
    expected_status: [200, 404]

- test:
    name: "Concurrent Request 9"
    url: http://localhost:8000/api/me
    method: GET
    headers: { template: { "Authorization": "Bearer $token" } }
    expected_status: [200]

- test:
    name: "Concurrent Request 10"
    url: http://localhost:8000/api/me
    method: GET
    headers: { template: { "Authorization": "Bearer $token" } }
    expected_status: [200]
